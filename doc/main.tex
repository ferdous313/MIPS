\documentclass[11pt, a4paper, twoside]{article}

\usepackage{multicol}
\setlength{\columnsep}{0.5cm}

% \usepackage{minted} 
\usepackage{fancyhdr}
\pagestyle{fancy}
\chead{Computer Architecture 2015 Fall}
\rhead{Project 1}
\cfoot{\thepage}
\title
{
	Pipeline
}
\author
{
  Chen, Chia-sheng\\
  B03902003
  \and
  Liu, Yen-ting\\
  B03902036
  \and
  Chao, Yi-ying\\
  B03902104
}
\date{\today}

\begin{document}
\maketitle

\section{Overall structure}

\subsection{Requirements}
The entire system is based on a simplified MIPS architecture. Register file contains 32 registers, with 1KBytes of instruction memory and 32Bytes of data memory.\\

Two types of hazard handling shall be implemented: data hazard and control hazard.
\begin{itemize}
\item \textbf{Data hazard} uses {\sc forwarding unit} to reduce or avoid the stall cycles, but forwarding to {\sc ID} stage isn't necessary. 
\item \textbf{Control hazard} should contain pipeline flush, and let the instructions follow by beq or j instruction to stall for 1 cycle if necessary.
\end{itemize}

% todo Not finish yet.

\subsection{Coding guideline}

\subsection{Instruction fetch}
For program counter multiplexer, there are four ways to go. The first is to add 4 to current address, which is to fetch the next line. The second is to add immediate of branch instructions if specific condition was met. The third is the jump instrction. And the last one is stall.
\subsection{Instruction decode}
\subsubsection{Instruction set}
There are 10 instructions we have to implement, they are grouped into their respective types below. 

\begin{table}[h]
	\centering
	\begin{tabular}{|c|ccc|}
	\hline
    Instruction & Type & Op & Func\\
    \hline
    and & ? & 000000 & 100100 \\
    or & ? & 000000 & 100101 \\
    add & ? & 000000 & 100000 \\
    sub & ? & 000000 & 100010 \\
    mul & ? & 000000 & 011000 \\
    lw & ? & 100011 & - \\
    sw & ? & 101011 & - \\
    beq & ? & 000100 & - \\
    j & ? & 000010 & - \\
    addi & ? & 001000 & - \\
    \hline
	\end{tabular}
\end{table}

Note: Since the TAs require us to test the result using the program provided, which also limits the way how OpCodes are assigned.\\

\subsubsection{Instruction format}

\subsection{Execution}
The main purpose of this section is to prepare all the data needed for ALU, and execute them. The data are either from register or forwarding from EX/MEM gate or MEM/WB gate. Forwarding unit are the signals controller of picking the data. Noticed that data could be stalled if special signal are received. 

\subsection{Memory}
There are two signals from MEM\_Ctrl of EX/MEM gate. One is $memread$, another $memwrite$, responsible for read and write respectively. For lw/sw instructions, DataOut is the address and Data2 the value.

\subsection{Write back}
It is possible for the CPU to write back to Data\_Mux, which is the input of ALU, or the register files. While accessibility of Data\_Mux are controlled by forwarding unit, the accessibility of register files are controlled by general control.
\subsection{Pipeline}
	
\section{Modules}
\subsection{Constants}
\subsection{Multiplexers}
\subsection{Registers}
\subsubsection{Pipeline stages}
\subsubsection{Register files}
\subsubsection{Program counter}
\subsection{Memories}
\subsubsection{Instructor memory}
\subsubsection{Data memory}
\subsection{ALU}
\subsubsection{Overall}
\subsubsection{Adder}
\subsubsection{Shift}
\subsubsection{Comparator}
\subsubsection{Sign extended}
\subsection{Control units}
\subsubsection{General control}
\subsubsection{ALU control}
\subsubsection{Hazard detection unit}
As for hazard detection unit, we refer to textbook p.302, the logical condition is \\
\[
if \(ID/EX.MemRead && \(\(ID/EX.Rt == IF/ID.Rs\) or\(ID/EX.Rt == IF/ID.Rt\)\)\) stall the pipeline
\]
How to stall the pipeline? We output stall signal which allow us to set the IF/ID register and PC to the origin value.

\subsubsection{Forwarding control unit}
Since we need to deal with data hazard, we implement forwarding control unit but without forwarding to ID stage

\section{Evaluation}
\subsection{Timing sequence verification}
\subsection{Test bench}
\subsection{Fibonacci}
	
\end{document}